#!/bin/sh
#
# Sync all branches to the kernel.org repository
#

. $(dirname "$0")/tip-lib

check_master

git-pull || exit 1;

# create missing local branches
tip-create-local-branches.sh

AB=`get_auto_branches`
BS=`git branch | sed "s/\* //"`

for B in $BS
do
    # Do not touch the local linus branch
    if [ "linus" == "$B" ]
    then 
	printf "%20s: skip\n" $B
    	continue;
    fi

    # Exclude autogenerated branches
    EXP=1
    for A in $AB
    do
	if [ "$A" == "$B" ]
	then 
	    EXP=0; 
	    break;
	fi
    done

    if [ $EXP -eq 0 ]
    then
	printf "%20s:  skip.\n" $B
	continue;
    fi

    printf "%-30s:  checkout ... " $B

    git-checkout $B       >/dev/null 2>/dev/null || { echo error; exit 1; }

    printf "merge ... "
    git-merge origin/$B   >/dev/null             || { echo error; exit 1; }
    printf "done.\n"
done

# switch back to master again
git-checkout master
