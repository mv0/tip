
git-checkout . || { echo error; exit -1; }

while :; do
  echo "next patch to process: "`quilt next`
  read -p "apply it?"
  git-am -i `quilt next` || exit -1
  read -p "remove from series file?"
  rm -rf .pc

  #
  # Remove the next patch from Quilt but leave some trace of
  # what happened:
  #
  quilt next >/dev/null 2>/dev/null && {
	PATCH_NAME=$(q next | cut -d/ -f2-)
	CURR_BRANCH=$(git-branch | grep ^\* | cut -c3-)
	echo "removing $PATCH_NAME"
	sed -i "s/^$PATCH_NAME$/# in -tip now: $PATCH_NAME/g" patches/series
  }

  echo "done!"
  echo
done
